FROM go-firecracker/dependencies:latest

ARG GIT_PROVIDER
ARG GIT_REPO
ARG BUILD_UID=1000

USER root

ADD . /go/src/$GIT_PROVIDER/$GIT_REPO
RUN chown -R $BUILD_UID:$BUILD_UID /go/src/$GIT_PROVIDER/$GIT_REPO

USER $BUILD_UID:$BUILD_UID
WORKDIR /go/src/$GIT_PROVIDER/$GIT_REPO

RUN dep ensure